<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Müsabaka & Puan Sistemi</title>
<style>
body {
  font-family: Arial;
  background:#0f0f0f;
  color:white;
  margin:0;
}
header {
  background:#ffc400;
  color:black;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
button {
  background:#ffc400;
  border:none;
  padding:8px 12px;
  cursor:pointer;
  font-weight:bold;
}
input { padding:6px; }
.section { padding:20px; }
.card {
  background:#1b1b1b;
  padding:10px;
  margin-bottom:10px;
  display:flex;
  align-items:center;
  gap:10px;
}
.card img {
  width:50px;
  height:50px;
  object-fit:cover;
  border-radius:50%;
}
.vs { margin:0 10px; font-weight:bold; color:#ffc400; }
.admin-only { display:none; }
.delete-btn {
  background:red;
  color:white;
}
</style>
</head>

<body>

<header>
  <div>
    <button onclick="show('matches')">Müsabakalar</button>
    <button onclick="show('scores')">Puan Listesi</button>
    <button onclick="show('admin')">ADMIN</button>
  </div>
  <div id="adminStatus">Admin: Kapalı</div>
</header>

<!-- MÜSABAKALAR -->
<div id="matches" class="section">
  <h2>Müsabakalar</h2>
  <div id="matchList"></div>

  <div class="admin-only">
    <h3>Müsabaka Ekle</h3>
    <input id="aName"><input id="aPhoto" placeholder="Foto URL">
    <span class="vs">VS</span>
    <input id="bName"><input id="bPhoto" placeholder="Foto URL">
    <button onclick="addMatch()">Ekle</button>
  </div>
</div>

<!-- PUAN -->
<div id="scores" class="section" style="display:none">
  <h2>Puan Listesi</h2>
  <div id="scoreList"></div>

  <div class="admin-only">
    <h3>Puan Ekle</h3>
    <input id="sName">
    <input id="sPhoto" placeholder="Foto URL">
    <input id="sPoint" type="number">
    <button onclick="addScore()">Kaydet</button>
  </div>
</div>

<!-- ADMIN -->
<div id="admin" class="section" style="display:none">
  <h2>Admin Girişi</h2>
  <input type="password" id="adminPass">
  <button onclick="login()">Giriş</button>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, getDocs, deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAf116Bb_Rv-rXI8C47EeaIlwxJQbPk7ic",
  authDomain: "szbalfightclub-3a1ae.firebaseapp.com",
  projectId: "szbalfightclub-3a1ae",
  storageBucket: "szbalfightclub-3a1ae.firebasestorage.app",
  messagingSenderId: "303031679666",
  appId: "1:303031679666:web:142d4e8b5c4201353a67ab"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let isAdmin = false;

window.show = (id)=>{
  ["matches","scores","admin"].forEach(s=>document.getElementById(s).style.display="none");
  document.getElementById(id).style.display="block";
}

window.login = ()=>{
  if(document.getElementById("adminPass").value==="ben1sma1ly1ld1r1m"){
    isAdmin=true;
    document.getElementById("adminStatus").innerText="Admin: Açık";
    document.querySelectorAll(".admin-only").forEach(e=>e.style.display="block");
    loadAll();
  } else alert("Hatalı şifre");
}

async function loadAll(){
  loadMatches();
  loadScores();
}

async function loadMatches(){
  matchList.innerHTML="";
  const snap = await getDocs(collection(db,"matches"));
  snap.forEach(d=>{
    const m=d.data();
    matchList.innerHTML+=`
    <div class="card">
      <img src="${m.aPhoto}">
      ${m.aName}
      <span class="vs">VS</span>
      <img src="${m.bPhoto}">
      ${m.bName}
      ${isAdmin?`<button class="delete-btn" onclick="deleteMatch('${d.id}')">Sil</button>`:""}
    </div>`;
  });
}

async function loadScores(){
  scoreList.innerHTML="";
  const snap = await getDocs(collection(db,"scores"));
  snap.forEach(d=>{
    const s=d.data();
    scoreList.innerHTML+=`
    <div class="card">
      <img src="${s.photo}">
      ${s.name} - ${s.point}
      ${isAdmin?`<button class="delete-btn" onclick="deleteScore('${d.id}')">Sil</button>`:""}
    </div>`;
  });
}

window.addMatch = async ()=>{
  if(!isAdmin) return;
  await addDoc(collection(db,"matches"),{
    aName:aName.value,aPhoto:aPhoto.value,
    bName:bName.value,bPhoto:bPhoto.value
  });
  loadMatches();
}

window.addScore = async ()=>{
  if(!isAdmin) return;
  await addDoc(collection(db,"scores"),{
    name:sName.value,photo:sPhoto.value,point:sPoint.value
  });
  loadScores();
}

window.deleteMatch = async(id)=>{
  if(!isAdmin) return;
  await deleteDoc(doc(db,"matches",id));
  loadMatches();
}

window.deleteScore = async(id)=>{
  if(!isAdmin) return;
  await deleteDoc(doc(db,"scores",id));
  loadScores();
}

loadAll();
</script>
</body>
</html>
